<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GJ Tech Company Pvt Ltd Test Online</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        /* Styles from your previous code */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 40px; /* Space for download message */
        }
        h1, h2, h3 {
            color: #0056b3;
            text-align: center;
            margin-top: 20px;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin-bottom: 8px;
        }
        .bold {
            font-weight: bold;
        }
        /* Main Layout */
        #main-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            padding: 20px;
            flex-wrap: wrap;
            display: none; /* Hidden by default, shown by JS */
            width: 100%;
            max-width: 1200px; /* Max width for the main content area */
        }
        /* Containers */
        #video-container,
        #quiz-container,
        #test-info-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px; /* Limit max width */
            margin: 20px auto; /* Center block elements when not in flex */
        }
        #test-info-container {
            margin-bottom: 20px;
            max-width: 800px; /* Align with other containers */
        }
        /* User Details Input Styling */
        #user-details-input {
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f0f7ff; /* Light blue background */
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #0056b3; /* Blue color */
        }
        .input-group input[type="text"] {
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        .input-error {
            color: #d9534f; /* Red color for errors */
            font-size: 12px;
            margin-top: 5px;
            display: none; /* Hidden by default */
        }
        /* Quiz Header */
        #quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }
        #quiz-header #question-area,
        #quiz-header #quiz-timer {
            flex: 1;
            min-width: 200px; /* Ensure elements don't become too small */
        }
        /* Question Area */
        #question-area {
            font-size: 25px;
            font-weight: bold;
        }
        /* Timer */
        #quiz-timer {
            font-size: 18px;
            font-weight: bold;
            color: #ff0000;
            text-align: right;
            display: none; /* Hidden initially */
        }
        /* Answer Options */
        #options-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        #options-area button {
            width: 100%; /* Make option buttons take full width */
            text-align: left; /* Align option text to the left */
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
            cursor: pointer;
        }
        #options-area button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        #options-area button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }
        /* Feedback for answer options */
        button.correct {
            background-color: #28a745; /* Green */
            color: white;
        }
        button.wrong {
            background-color: #dc3545; /* Red */
            color: white;
        }
        /* Buttons */
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            transition: background-color 0.3s ease, opacity 0.3s ease;
            cursor: pointer;
        }
        button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }
        /* Specific Buttons */
        #start-button {
            display: block; /* Display initially */
            margin: 20px auto; /* Center the button */
        }
        #next-button,
        #submit-button, /* Not used in JS, but good to have style */
        .download-button {
            background-color: #28a745; /* Green */
        }
        #next-button:hover:not(:disabled),
        #submit-button:hover:not(:disabled),
        .download-button:hover:not(:disabled) {
            background-color: #218838; /* Darker green */
        }
        #cancel-button {
            background-color: #dc3545; /* Red */
        }
        #cancel-button:hover:not(:disabled) {
            background-color: #c82333; /* Darker red */
        }
        /* Quiz Result */
        #result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        /* Cheating Detection Message */
        #cheating-detection {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8d7da; /* Light red background */
            color: #721c24; /* Dark red text */
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            display: none; /* Hidden by default */
        }
        #cheating-detection button {
            margin-top: 10px;
        }
        /* Webcam Container */
        #video-container {
            text-align: center; /* Center the video element */
            margin-top: 5px;
        }
        #camera-feed {
            width: 100%;
            max-width: 400px;
            height: auto;
            border: 1px solid #ccc;
            border-radius: 8px;
            display: block;
            margin: auto;
            background-color: #000; /* Black background for video area */
        }
        #certificate-container {
            text-align: center;
            margin-top: 30px;
            display: none; /* Hidden initially */
            padding: 30px;
            background-color: #e9f7ef;
            max-width: 800px;
            margin: 30px auto;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        #certificate-container h2 {
            font-family: 'Great Vibes', cursive;
            font-size: 40px;
            color: #0056b3;
            margin-bottom: 10px;
        }
        #certificate-container p {
            font-size: 18px;
            margin-bottom: 5px;
        }
        #certificate-container .bold {
            font-size: 22px;
            color: #333;
        }
        #certificate-container #signature {
            margin-top: 20px;
            font-style: italic;
            color: #555;
        }
        /* Small Certificate for PDF */
        .small-certificate {
            font-family: sans-serif;
            padding: 20mm; /* Use mm for better print sizing */
            border: 2mm solid #0056b3;
            width: 180mm; /* A bit less than A4 width to fit margins */
            margin: 20mm auto; /* Center on page with margins */
            background: linear-gradient(to bottom, #ffffff, #f0f7ff); /* Subtle gradient */
            box-shadow: 0 0 10mm rgba(0, 0, 0, 0.2);
            position: absolute !important; /* Position off-screen for html2pdf */
            left: -9999px !important; /* Move off-screen */
            opacity: 0 !important; /* Ensure it's not visible */
            display: block !important; /* Ensure it's block for html2pdf */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            color: #333; /* Default text color for the certificate */
        }
        /* Ensure elements within small certificate have sizes relative to mm */
        .small-certificate * {
            box-sizing: border-box;
        }
        .small-certificate .header {
            display: flex;
            align-items: center;
            justify-content: center; /* Center header content */
            margin-bottom: 15mm;
            border-bottom: 1mm solid #eee;
            padding-bottom: 10mm;
        }

        .small-certificate .header img {
            width: 15mm; /* Use mm for image size in certificate */
            height: 15mm; /* Use mm for image size in certificate */
            margin-right: 5mm;
            object-fit: contain; /* Ensure logo fits without distortion */
        }

        .small-certificate .header h3 {
            font-size: 10pt; /* Use pt for print size */
            margin: 0;
            color: #0056b3;
        }
        .small-certificate .certificate-title {
            font-size: 20pt; /* Use pt for print size */
            font-weight: bold;
            text-align: center;
            margin-bottom: 15mm;
            color: #333;
            text-transform: uppercase;
        }
        .small-certificate .content p {
            font-size: 12pt; /* Use pt for print size */
            line-height: 1.5;
            margin-bottom: 5mm;
            text-align: justify;
        }
        .small-certificate .content .details {
            font-weight: bold;
            color: #0056b3;
            /* text-decoration: underline; */ /* Optional: underline details */
        }
        .small-certificate .score-details {
            font-size: 14pt; /* Use pt for print size */
            font-weight: bold;
            text-align: center;
            margin-top: 15mm;
            color: #28a745; /* Green */
        }
        .small-certificate .badge {
            position: absolute; /* Position relative to certificate container */
            top: 20mm;
            right: 20mm;
            width: 20mm; /* Use mm for badge size */
            height: 20mm; /* Use mm for badge size */
        }
        .small-certificate .badge img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .small-certificate .footer {
            display: flex;
            justify-content: space-between;
            margin-top: 20mm;
            padding-top: 10mm;
            border-top: 1mm solid #eee;
            font-size: 10pt; /* Use pt for print size */
            color: #555;
        }
        .small-certificate .signature {
            display: flex;
            justify-content: space-around;
            margin-top: 20mm;
            text-align: center;
        }
        .small-certificate .signature-block {
            flex: 1;
            margin: 0 10mm;
            text-align: center; /* Center content including signature image */
        }
        .small-certificate .signature-block img { /* Style for the digital signature image */
            width: 50mm; /* Adjust size as needed */
            height: auto;
            display: block;
            margin: 0 auto 5mm; /* Center image and add space below */
        }
        .small-certificate .signature-block .signature-name {
            font-weight: bold;
            font-size: 12pt; /* Use pt for print size */
            margin-bottom: 2mm;
            border-bottom: 1mm solid #000; /* Line for signature, if desired */
            display: inline-block; /* Shrink line to text width */
            padding-bottom: 2mm;
        }
        /* Adjust for Gajendra Singh's signature if using an image */
        .small-certificate .signature-block.gajendra-signature .signature-name {
            border-bottom: none; /* Remove line if image acts as the signature */
        }
        .small-certificate .signature-block .signature-title {
            font-size: 10pt; /* Use pt for print size */
            color: #555;
        }
        .small-certificate .photo {
            position: absolute; /* Position relative to certificate container */
            bottom: 20mm;
            right: 20mm;
            width: 30mm; /* Photo size */
            height: 40mm; /* Photo size */
            border: 1mm solid #ccc;
            background-color: #eee; /* Placeholder background */
            display: flex; /* Use flexbox to center content */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            overflow: hidden; /* Hide overflow if image is too large */
        }
        .small-certificate .photo img {
            width: 100%; /* Make image fill the div */
            height: 100%; /* Make image fill the div */
            object-fit: cover; /* Cover the area without distorting aspect ratio */
        }
        /* Hidden canvas used for photo capture */
        #photo-canvas {
            display: none;
        }
        /* Google Form Link Container */
        #google-form-link-container {
            margin-top: 30px;
            padding: 20px;
            background-color: #fff3cd; /* Light yellow */
            border: 1px solid #ffecb5;
            border-radius: 8px;
            text-align: center;
            max-width: 800px;
            margin: 30px auto;
            display: none; /* Hidden by default */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        #google-form-link-container p {
            margin-bottom: 15px;
            font-size: 16px;
            color: #664d03; /* Dark yellow text */
        }
        #google-form-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #ffc107; /* Yellow */
            color: #212529; /* Dark text */
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        #google-form-link:hover {
            background-color: #e0a800; /* Darker yellow */
        }
        #download-message {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
            text-align: center;
            display: none;
        }
        /* Responsive Design */
        @media (max-width: 768px) {
            #main-container {
                flex-direction: column;
                align-items: center;
            }
            #video-container,
            #quiz-container,
            #test-info-container {
                width: 95%; /* Adjust width for smaller screens */
                max-width: none;
                margin: 10px auto; /* Adjust margin */
            }
            #quiz-header {
                flex-direction: column;
                gap: 15px; /* Adjust gap */
                align-items: flex-start; /* Align items to the start in column layout */
            }
            #quiz-header #question-area,
            #quiz-header #quiz-timer {
                width: 100%; /* Take full width */
                text-align: left; /* Align text to the left */
            }
            #quiz-timer {
                text-align: right; /* Keep timer right-aligned */
            }
            /* Small Certificate (PDF) responsive adjustments might not be strictly necessary as it's for print layout,
                but keeping some general adjustments for display before printing is good practice */
            .small-certificate {
                padding: 10mm; /* Reduce padding */
                width: 95%; /* Use percentage for width in case it's briefly shown */
                margin: 10mm auto; /* Adjust margin */
                border: 1mm solid #0056b3; /* Adjust border */
                box-shadow: 0 0 5mm rgba(0, 0, 0, 0.1); /* Adjust shadow */
                /* Keep absolute positioning for html2pdf but maybe adjust top/left slightly if needed for debugging */
                position: absolute !important;
                left: -9999px !important;
                opacity: 0 !important;
                display: block !important;
            }
            .small-certificate .header {
                flex-direction: column; /* Stack header items */
                align-items: center; /* Center items */
                margin-bottom: 10mm; /* Adjust margin */
                padding-bottom: 5mm; /* Adjust padding */
            }
            .small-certificate .header img {
                width: 10mm; /* Adjust logo size */
                height: 10mm; /* Adjust logo size */
                margin-right: 0; /* Remove margin */
                margin-bottom: 5mm; /* Add bottom margin */
            }
            .small-certificate .header h3 {
                font-size: 10pt; /* Adjust font size */
                text-align: center; /* Center title */
            }
            .small-certificate .certificate-title {
                font-size: 16pt; /* Adjust font size */
                margin-bottom: 10mm; /* Adjust margin */
            }
            .small-certificate .content p {
                font-size: 10pt; /* Reduce font size */
                margin-bottom: 3mm; /* Adjust margin */
                text-align: left; /* Adjust alignment */
            }
            .small-certificate .score-details {
                font-size: 12pt;
                margin-top: 10mm;
            }
            .small-certificate .badge {
                position: static !important; /* Remove absolute positioning for display */
                margin: 5mm auto !important; /* Center badge */
                display: block !important;
                width: 15mm !important; /* Adjust badge size */
                height: 15mm !important; /* Adjust badge size */
            }
            .small-certificate .badge img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }
            .small-certificate .footer {
                flex-direction: column; /* Stack footer items */
                align-items: center; /* Center items */
                margin-top: 10mm; /* Adjust margin */
                padding-top: 5mm; /* Adjust padding */
            }
            .small-certificate .footer p {
                margin: 2mm 0; /* Add margin between footer items */
            }
            .small-certificate .signature {
                flex-direction: column; /* Stack signatures */
                gap: 10mm; /* Add gap between signatures */
                margin-top: 15mm; /* Adjust margin */
            }

            .small-certificate .signature-block {
                margin: 0; /* Remove horizontal margin */
            }
            .small-certificate .signature-block .signature-name {
                font-size: 10pt; /* Reduce font size */
                border-bottom: 0.5mm solid #000; /* Adjust border thickness */
            }
            .small-certificate .signature-block.gajendra-signature .signature-name {
                border-bottom: none; /* Keep border-bottom none for image signature */
            }
            .small-certificate .signature-block .signature-title {
                font-size: 8pt; /* Reduce font size */
            }
            .small-certificate .photo {
                position: static !important; /* Remove absolute positioning for display */
                width: 20mm !important; /* Adjust size */
                height: 25mm !important; /* Adjust size */
                margin: 10mm auto 0 !important; /* Center photo with top margin */
                display: flex !important; /* Maintain flex for centering content */
            }
            .small-certificate .photo img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
        }
    </style>
</head>
<body>
    <h1> GJ Tech - Mobile Computing  Online Test</h1>
    <div id="test-info-container">
        <h2>Welcome GJ Tech - Mobile Computing & Android Overview</h2>
        <p>Please read the following instructions carefully before starting the test:</p>
        <ul>
            <li>This test consists of <span id="total-questions">32</span> multiple-choice questions.</li>
            <li>You have <span id="test-duration-minutes">20</span> minutes to complete the test.</li>
            <li>Your camera feed will be active during the test for proctoring purposes. Ensure your face is clearly visible.</li>
            <li>Do not navigate away from the test window or open other applications during the test.</li>
            <li>Potential cheating activity may result in the cancellation of your test.</li>
            <li>A passing score of <span id="passing-score-percentage">70</span>% is required to receive a certificate.</li>
        </ul>
        <div id="user-details-input">
            <div class="input-group">
                <label for="name-input">Full Name:</label>
                <input type="text" id="name-input" placeholder="Your Full Name">
                <div id="name-input-error" class="input-error">Please enter your name.</div>
            </div>
            <div class="input-group">
                <label for="father-name-input">Father's Name:</label>
                <input type="text" id="father-name-input" placeholder="Your Father's Name">
                <div id="father-name-input-error" class="input-error">Please enter your father's name.</div>
            </div>
            <div class="input-group">
                <label for="district-input">District:</label>
                <input type="text" id="district-input" placeholder="Your District">
                <div id="district-input-error" class="input-error">Please enter your district.</div>
            </div>
            <div class="input-group">
                <label for="state-input">State:</label>
                <input type="text" id="state-input" placeholder="Your State">
                <div id="state-input-error" class="input-error">Please enter your state.</div>
            </div>
        </div>
        <p>Click the button below to start the test.</p>
    </div>
    <button id="start-button">Start Test</button>
    <div id="main-container">
        <div id="video-container">
            <h3>Your Camera Feed ðŸ“¸</h3>
            <video id="camera-feed" autoplay playsinline></video>
        </div>
        <div id="quiz-container">
            <div id="quiz-header">
                <div id="question-area" class="question"></div>
                <div id="quiz-timer"></div>
            </div>
            <div id="options-area" class="options"></div>
            <div id="result"></div>
            <button id="next-button" style="display: none;">Next Question</button>
            <div id="cheating-detection">
                Potential cheating detected! The quiz will be cancelled.
                <button id="cancel-button">Acknowledge & End Quiz</button>
            </div>
        </div>
    </div>
    <div id="certificate-container">
        <h2>Certificate of Completion</h2>
        <p>This certificate is awarded to</p>
        <p class="bold" id="certificate-user-name">Participant</p>
        <p>for successfully completing the HTML online test.</p>
        <p>Awarded on: <span class="bold" id="certificate-completion-date">[Date of Completion]</span></p>
        <p>Score Achieved: <span class="bold" id="certificate-score-large">[Score]%</span></p>
        <img src="singture.jpg" alt="Gajendra Singh" style="width: 80px; height: auto; margin-bottom: 5px;">
    </div>
    <div class="certificate small-certificate" id="small-certificate">
        <div class="header">
            <img src="https://via.placeholder.com/60x60/cccccc/333333?text=Logo" alt="Company Logo">
            <h3>GJ Tech Company Pvt Ltd.</h3>
        </div>
        <div class="certificate-title">Certificate of Completion</div>
        <div class="content">
            <p>This is to certify that Mr./Ms. <span class="details" id="small-certificate-user-name"></span>,</p>
            <p>Son/Daughter of Shri <span class="details" id="small-certificate-father-name"></span>,</p>
            <p>Resident of District <span class="details" id="small-certificate-district"></span>, State <span class="details" id="small-certificate-state"></span>,</p>
            <p>has successfully completed the <strong>GJ Tech Company (GJC) Certification Program</strong> offered by GJ Tech Company Pvt Ltd.</p>
            <p class="score-details">Score Achieved: <span class="details" id="small-certificate-score"></span></p>
        </div>
        <div class="badge">
            <img src="https://via.placeholder.com/50x50/cccccc/333333?text=Badge" alt="Achievement Badge">
        </div>
        <div class="footer">
            <p id="small-certificate-date"></p>
            <p>Place: Moradabad</p>
        </div>
        <div class="signature">
            <div class="signature-block">
                <div class="signature-name">Narendra Hindwar</div>
                <div class="signature-title">Authorized Signatory</div>
            </div>
            <div class="signature-block gajendra-signature">
                <img src="sin.jpg" alt="Gajendra " style="width: 80px; height: auto; margin-bottom: 5px;">
                <div class="signature-title">Secretary<br>GJ Tech Company Pvt Ltd.</div>
            </div>
        </div>
        <div class="photo" id="certificate-photo-area"></div>
    </div>
    <button id="download-small-certificate-button" class="download-button" style="display: none; margin: 20px auto;">Download Certificate (Official)</button>
    <p id="download-message" style="display: none; text-align: center;">Your certificate will be downloaded to your browser's default download folder or you will be prompted to save it.</p>
    <canvas id="photo-canvas"></canvas>
    <div id="google-form-link-container">
        <p>You did not achieve the passing score for a certificate. Please use the button below to provide details if you'd like to explore other options or re-attempt the test (if available).</p>
        <a href="https://forms.gle/YOUR_ACTUAL_GOOGLE_FORM_LINK" id="google-form-link" target="_blank">Provide Details / Explore Options</a>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        const cameraFeed = document.getElementById('camera-feed');
        const startButton = document.getElementById('start-button');
        const quizContainer = document.getElementById('quiz-container');
        const questionArea = document.getElementById('question-area');
        const optionsArea = document.getElementById('options-area');
        const resultDisplay = document.getElementById('result');
        const nextButton = document.getElementById('next-button');
        const mainContainer = document.getElementById('main-container');
        const cheatingDetectionDiv = document.getElementById('cheating-detection');
        const cancelButton = document.getElementById('cancel-button');
        const certificateDiv = document.getElementById('certificate-container');
        const certificateUserName = document.getElementById('certificate-user-name');
        const certificateCompletionDate = document.getElementById('certificate-completion-date');
        const certificateScoreLarge = document.getElementById('certificate-score-large');
        const smallCertificateDiv = document.getElementById('small-certificate');
        const smallCertificateUserName = document.getElementById('small-certificate-user-name');
        const smallCertificateFatherName = document.getElementById('small-certificate-father-name');
        const smallCertificateDistrict = document.getElementById('small-certificate-district');
        const smallCertificateState = document.getElementById('small-certificate-state');
        const smallCertificatePhotoDiv = document.querySelector('#small-certificate .photo');
        const smallCertificateDate = document.getElementById('small-certificate-date');
        const smallCertificateScore = document.getElementById('small-certificate-score');
        const downloadSmallCertificateButton = document.getElementById('download-small-certificate-button');
        const downloadMessage = document.getElementById('download-message');
        const quizTimerDisplay = document.getElementById('quiz-timer');
        const testInfoContainer = document.getElementById('test-info-container');
        const totalQuestionsSpan = document.getElementById('total-questions');
        const testDurationMinutesSpan = document.getElementById('test-duration-minutes');
        const passingScorePercentageSpan = document.getElementById('passing-score-percentage');
        const googleFormLinkContainer = document.getElementById('google-form-link-container');
        const userDetailsInput = document.getElementById('user-details-input');
        const nameInput = document.getElementById('name-input');
        const fatherNameInput = document.getElementById('father-name-input');
        const districtInput = document.getElementById('district-input');
        const stateInput = document.getElementById('state-input');
        const nameInputError = document.getElementById('name-input-error');
        const fatherNameInputError = document.getElementById('father-name-input-error');
        const districtInputError = document.getElementById('district-input-error');
        const stateInputError = document.getElementById('state-input-error');
        const photoCanvas = document.getElementById('photo-canvas');
        const photoCanvasCtx = photoCanvas.getContext('2d');
        let userName = "";
        let fatherName = "";
        let district = "";
        let state = "";
        let capturedPhotoDataUrl = null;
        let stream;
        let currentQuestionIndex = 0;
        let score = 0;
        let answerSelected = false;
        let cheatingDetected = false;
        let quizActive = false;
        let completionDate;
        let quizCancelledByCheat = false;
        let periodicPhotoInterval;
        let cheatDetectionInterval;
        const quizDurationMinutes = parseInt(testDurationMinutesSpan.textContent, 10);
        const quizDurationSeconds = quizDurationMinutes * 60;
        let timeRemaining = quizDurationSeconds;
        let quizTimerInterval;
        const passingScorePercentage = parseInt(passingScorePercentageSpan.textContent, 10);
        const totalQuestions = 32; // Updated total number of questions
        // Updated questions array with new HTML and mobile development questions
        const questions = [
            {
                question: "What does HTML stand for?",
                options: ["Hyper Text Markup Language", "Highly Typed Machine Language", "Hyperlink and Text Management Language", "Home Tool Markup Language"],
                answer: "Hyper Text Markup Language"
            },
            {
                question: "Which tag is used to create an unordered list in HTML?",
                options: ["&lt;ol&gt;", "&lt;ul&gt;", "&lt;li&gt;", "&lt;list&gt;"],
                answer: "&lt;ul&gt;"
            },
            {
                question: "What is the correct HTML tag for inserting a line break?",
                options: ["&lt;br&gt;", "&lt;lb&gt;", "&lt;break&gt;", "&lt;newline&gt;"],
                answer: "&lt;br&gt;"
            },
            {
                question: "Which HTML tag is used to create an ordered list?",
                options: ["&lt;ul&gt;", "&lt;list&gt;", "&lt;ol&gt;", "&lt;dl&gt;"],
                answer: "&lt;ol&gt;"
            },
            {
                question: "What does the acronym CSS stand for?",
                options: ["Creative Style Sheets", "Computer Style Sheets", "Cascading Style Sheets", "Colorful Style Sheets"],
                answer: "Cascading Style Sheets"
            },
            {
                question: "Which HTML attribute is used to define inline styles?",
                options: ["style", "class", "id", "font"],
                answer: "style"
            },
            {
                question: "Which HTML tag is used to define the title of an HTML document?",
                options: ["&lt;header&gt;", "&lt;meta&gt;", "&lt;title&gt;", "&lt;head&gt;"],
                answer: "&lt;title&gt;"
            },
            {
                question: "Which of the following is the correct way to link an external CSS file to an HTML document?",
                options: ["&lt;style src=\"styles.css\">", "&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\">", "&lt;stylesheet>styles.css</stylesheet>", "&lt;css file=\"styles.css\">"],
                answer: "&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\">"
            },
            {
                question: "Which HTML tag is used to create a hyperlink?",
                options: ["&lt;link&gt;", "&lt;a&gt;", "&lt;hlink&gt;", "&lt;url&gt;"],
                answer: "&lt;a&gt;"
            },
            {
                question: "What is the purpose of the `alt` attribute in the `<img>` tag?",
                options: ["To provide an alternative style for the image.", "To specify the alignment of the image.", "To provide alternative text for the image if it cannot be displayed.", "To add a tooltip to the image."],
                answer: "To provide alternative text for the image if it cannot be displayed."
            },
            {
                question: "Which HTML tag is used to define a table?",
                options: ["&lt;layout&gt;", "&lt;table&gt;", "&lt;grid&gt;", "&lt;data&gt;"],
                answer: "&lt;table&gt;"
            },
            {
                question: "What is the purpose of the `&lt;meta charset=\"UTF-8\"&gt;` tag in HTML?",
                options: ["To define the character encoding for the document.", "To set the author of the document.", "To specify keywords for search engines.", "To control the viewport settings."],
                answer: "To define the character encoding for the document."
            },
            {
                question: "Which of the following is a popular operating system for mobile devices?",
                options: ["Windows", "macOS", "Android", "Linux"],
                answer: "Android"
            },
            {
                question: "What is the primary programming language used for native Android development?",
                options: ["Swift", "Objective-C", "Java (increasingly Kotlin)", "C#"],
                answer: "Java (increasingly Kotlin)"
            },
            {
                question: "What is the primary programming language used for native iOS development?",
                options: ["Java", "Kotlin", "Swift", "Python"],
                answer: "Swift"
            },
            {
                question: "What is a key benefit of cross-platform mobile development?",
                options: ["Higher performance than native apps.", "Single codebase for multiple platforms.", "Full access to all device-specific hardware features.", "Automatic optimization for each operating system."],
                answer: "Single codebase for multiple platforms."
            },
            {
                question: "Which of the following is a popular cross-platform framework developed by Google?",
                options: ["React Native", "Ionic", "Flutter", "Xamarin"],
                answer: "Flutter"
            },
            {
                question: "What is the function of a mobile app emulator?",
                options: ["To install apps on physical devices.", "To simulate a mobile device on a computer for testing.", "To design the user interface of an app.", "To translate code into different languages."],
                answer: "To simulate a mobile device on a computer for testing."
            },
            {
                question: "What does UI generally refer to in mobile app development?",
                options: ["Underlying Infrastructure", "User Interaction", "User Interface", "Universal Integration"],
                answer: "User Interface"
            },
            {
                question: "What does UX generally refer to in mobile app development?",
                options: ["User Extension", "Universal Exchange", "User Experience", "Utility Exchange"],
                answer: "User Experience"
            },
            {
                question: "What is an APK file commonly used for?",
                options: ["Storing iOS app data.", "Distributing and installing Android apps.", "Designing mobile app interfaces.", "Compiling code for web browsers."],
                answer: "Distributing and installing Android apps."
            },
            {
                question: "What is an IPA file commonly used for?",
                options: ["Distributing and installing iOS apps.", "Storing Android app data.", "Managing databases in mobile apps.", "Creating animations for mobile websites."],
                answer: "Distributing and installing iOS apps."
            }
            // Add the remaining 10 questions you provided earlier here
            ,
            {
                question: "What is the correct HTML tag for inserting a line break?",
                options: ["<br>", "<lb>", "<break>", "<newline>"],
                answer: "<br>"
            },
            {
                question: "Which HTML tag is used to create an ordered list?",
                options: ["<ul>", "<list>", "<ol>", "<dl>"],
                answer: "<ol>"
            },
            {
                question: "What does the acronym CSS stand for?",
                options: ["Creative Style Sheets", "Computer Style Sheets", "Cascading Style Sheets", "Colorful Style Sheets"],
                answer: "Cascading Style Sheets"
            },
            {
                question: "Which HTML attribute is used to define inline styles?",
                options: ["style", "class", "id", "font"],
                answer: "style"
            },
            {
                question: "Which HTML tag is used to define the title of an HTML document?",
                options: ["<header>", "<meta>", "<title>", "<head>"],
                answer: "<title>"
            },
            {
                question: "Which of the following is the correct way to link an external CSS file to an HTML document?",
                options: ["<style src=\"styles.css\">", "<link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\">", "<stylesheet>styles.css</stylesheet>", "<css file=\"styles.css\">"],
                answer: "<link rel=\"stylesheet\" type=\"text/css\" href=\"styles.css\">"
            },
            {
                question: "Which HTML tag is used to create a hyperlink?",
                options: ["<link>", "<a>", "<hlink>", "<url>"],
                answer: "<a>"
            },
            {
                question: "What is the purpose of the `alt` attribute in the `<img>` tag?",
                options: ["To provide an alternative style for the image.", "To specify the alignment of the image.", "To provide alternative text for the image if it cannot be displayed.", "To add a tooltip to the image."],
                answer: "To provide alternative text for the image if it cannot be displayed."
            },
            {
                question: "Which HTML tag is used to define a table?",
                options: ["<layout>", "<table>", "<grid>", "<data>"],
                answer: "<table>"
            },
            {
                question: "What is the purpose of the `<meta charset=\"UTF-8\">` tag in HTML?",
                options: ["To define the character encoding for the document.", "To set the author of the document.", "To specify keywords for search engines.", "To control the viewport settings."],
                answer: "To define the character encoding for the document."
            }
        ];

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                cameraFeed.srcObject = stream;
            } catch (err) {
                console.error("Error accessing camera:", err);
                alert("Failed to access camera. Please ensure you have granted permission.");
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                cameraFeed.srcObject = null;
            }
        }

        function capturePhoto() {
            photoCanvas.width = cameraFeed.videoWidth;
            photoCanvas.height = cameraFeed.videoHeight;
            photoCanvasCtx.drawImage(cameraFeed, 0, 0, photoCanvas.width, photoCanvas.height);
            capturedPhotoDataUrl = photoCanvas.toDataURL('image/jpeg');
            if (smallCertificatePhotoDiv) {
                smallCertificatePhotoDiv.innerHTML = `<img src="${capturedPhotoDataUrl}" alt="User Photo">`;
            }
        }

        function validateUserDetails() {
            userName = nameInput.value.trim();
            fatherName = fatherNameInput.value.trim();
            district = districtInput.value.trim();
            state = stateInput.value.trim();

            let isValid = true;
            if (!userName) {
                nameInputError.style.display = 'block';
                isValid = false;
            } else {
                nameInputError.style.display = 'none';
            }
            if (!fatherName) {
                fatherNameInputError.style.display = 'block';
                isValid = false;
            } else {
                fatherNameInputError.style.display = 'none';
            }
            if (!district) {
                districtInputError.style.display = 'block';
                isValid = false;
            } else {
                districtInputError.style.display = 'none';
            }
            if (!state) {
                stateInputError.style.display = 'block';
                isValid = false;
            } else {
                stateInputError.style.display = 'none';
            }
            return isValid;
        }

        function startQuiz() {
            if (!validateUserDetails()) {
                return;
            }
            testInfoContainer.style.display = 'none';
            startButton.style.display = 'none';
            mainContainer.style.display = 'flex';
            quizContainer.style.display = 'block';
            quizTimerDisplay.style.display = 'block';
            currentQuestionIndex = 0;
            score = 0;
            timeRemaining = quizDurationSeconds;
            quizActive = true;
            cheatingDetected = false;
            quizCancelledByCheat = false;
            startTimer();
            displayQuestion();
            periodicPhotoInterval = setInterval(capturePhoto, 30000); // Capture photo every 30 seconds
            // Basic cheating detection (more sophisticated methods can be added)
            cheatDetectionInterval = setInterval(function() {
                if (document.hidden) {
                    if (quizActive && !quizCancelledByCheat) {
                        cheatingDetected = true;
                        showCheatingDetectionMessage();
                        endQuiz();
                    }
                }
            }, 1000);
        }

        function displayQuestion() {
            if (currentQuestionIndex < questions.length) {
                const questionData = questions[currentQuestionIndex];
                questionArea.textContent = `${currentQuestionIndex + 1}. ${questionData.question}`;
                optionsArea.innerHTML = '';
                questionData.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.addEventListener('click', () => checkAnswer(option, questionData.answer));
                    optionsArea.appendChild(button);
                });
                nextButton.style.display = 'none';
                answerSelected = false;
            } else {
                endQuiz();
            }
        }

        function checkAnswer(selectedOption, correctAnswer) {
            if (!quizActive || answerSelected) {
                return;
            }
            answerSelected = true;
            const buttons = optionsArea.querySelectorAll('button');
            buttons.forEach(button => {
                if (button.textContent === correctAnswer) {
                    button.classList.add('correct');
                } else if (button.textContent === selectedOption && selectedOption !== correctAnswer) {
                    button.classList.add('wrong');
                }
                button.disabled = true;
            });

            if (selectedOption === correctAnswer) {
                score++;
            }

            if (currentQuestionIndex < questions.length - 1) {
                nextButton.style.display = 'block';
            } else {
                endQuiz();
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        function startTimer() {
            quizTimerInterval = setInterval(function () {
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                quizTimerDisplay.textContent = `Time Remaining: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                timeRemaining--;
                if (timeRemaining < 0) {
                    endQuiz();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(quizTimerInterval);
        }

        function showCheatingDetectionMessage() {
            quizContainer.style.display = 'none';
            cheatingDetectionDiv.style.display = 'block';
        }

        function handleCancelQuiz() {
            quizCancelledByCheat = true;
            endQuiz();
        }

        function endQuiz() {
            quizActive = false;
            stopTimer();
            clearInterval(periodicPhotoInterval);
            clearInterval(cheatDetectionInterval);
            stopCamera();
            mainContainer.style.display = 'none';
            quizContainer.style.display = 'none';
            cheatingDetectionDiv.style.display = 'none';
            completionDate = new Date().toLocaleDateString();
            certificateCompletionDate.textContent = completionDate;

            const percentageScore = (score / questions.length) * 100;
            const roundedScore = Math.round(percentageScore);
            certificateScoreLarge.textContent = `${roundedScore}%`;

            smallCertificateUserName.textContent = userName;
            smallCertificateFatherName.textContent = fatherName;
            smallCertificateDistrict.textContent = district;
            smallCertificateState.textContent = state;
            smallCertificateDate.textContent = completionDate;
            smallCertificateScore.textContent = `${roundedScore}%`;

            if (roundedScore >= passingScorePercentage) {
                certificateDiv.style.display = 'block';
                downloadSmallCertificateButton.style.display = 'block';
                downloadMessage.style.display = 'block';
                googleFormLinkContainer.style.display = 'none';
            } else {
                certificateDiv.style.display = 'none';
                downloadSmallCertificateButton.style.display = 'none';
                downloadMessage.style.display = 'none';
                googleFormLinkContainer.style.display = 'block';
            }
        }

        startButton.addEventListener('click', startQuiz);
        nextButton.addEventListener('click', nextQuestion);
        cancelButton.addEventListener('click', handleCancelQuiz);

        downloadSmallCertificateButton.addEventListener('click', () => {
            const element = document.getElementById('small-certificate');
            const opt = {
                margin: [10, 10, 10, 10],
                filename: 'certificate.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().from(element).set(opt).save();
        });

        // Start camera feed when the page loads
        startCamera();
    </script>
</body>
</html>